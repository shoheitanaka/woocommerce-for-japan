"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[26],{5026:(t,n,e)=>{e.r(n),e.d(n,{default:()=>_,initPoyntPaymentProvider:()=>_});var i=e(655),o=e(9545),r=e(9276),a=e(9213),s=e(9536),d=e(7462),c=e(7629),p=e(9970),u=e(8401),l=e(7059),h=e(3658),v=e(6204),f=e(6673),y=e(1212),m=e(4071);function b(){l.h.subscribe((function(){!function(t,n,e){"poynt"===t&&e>0?(0,o.HD)(".poynt-btn-container",(function(t){t.classList.remove("hide")})):(0,o.HD)(".poynt-btn-container",(function(t){t.classList.add("hide")}));"poynt"===t&&"loading"!==n&&e>0?(0,o.HD)(".poynt-btn",(function(t){t.classList.remove("hide")})):(0,o.HD)(".poynt-btn",(function(t){t.classList.add("hide")}))}(c.hv.selectedProvider(),d.qA.modalUI.loadingMode(),f.z9.total()),function(t,n){if("poynt"!==t)return;"finished"===n?(0,o.HD)(".poynt-btn",(function(t){t.disabled=!1})):(0,o.HD)(".poynt-btn",(function(t){t.disabled=!0}));"loading"===n?(0,o.HD)(".pp-btn-spinner-container",(function(t){t.classList.remove("hide")})):(0,o.HD)(".pp-btn-spinner-container ",(function(t){t.classList.add("hide")}));"processing"===n?((0,o.HD)(".poynt-btn > .button-text",(function(t){t.innerHTML=(0,m.M)("Processing")})),(0,o.HD)(".modal-lock-icon",(function(t){t.classList.add("hide")})),(0,o.HD)(".poynt-btn-spinner",(function(t){t.classList.remove("hide")}))):((0,o.HD)(".poynt-btn > .button-text",(function(t){t.innerHTML="".concat((0,m.M)("Pay")," ").concat((0,y.o)(f.AQ.total()))})),(0,o.HD)(".poynt-btn-spinner",(function(t){t.classList.add("hide")})))}(c.hv.selectedProvider(),d.qA.modalUI.loadingMode())}))}var g=e(5792),w=function(){function t(t){this.businessId=t.businessId,this.applicationId=t.applicationId,this.$cardElement=new TokenizeJs(this.businessId,this.applicationId)}return t.prototype.mount=function(t,n){this.$cardElement.mount(t,document,n)},t.prototype.tokenize=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t=this;return(0,i.Jh)(this,(function(n){return[2,new Promise((function(n){t.$cardElement.on("nonce",(function(t){t.data.nonce&&n({nonce:t.data.nonce})})),t.$cardElement.on("error",(function(t){var e,i,o,r,a;n({error:null!==(a=null!==(i=null===(e=t.data)||void 0===e?void 0:e.message)&&void 0!==i?i:null===(r=null===(o=t.data)||void 0===o?void 0:o.error)||void 0===r?void 0:r.message)&&void 0!==a?a:"Something went wrong. Please try again."})})),t.$cardElement.getNonce({businessId:t.businessId})}))]}))}))},t}();function _(t){return(0,i.mG)(this,void 0,void 0,(function(){var n,e,f,y;return(0,i.Jh)(this,(function(_){switch(_.label){case 0:return d.L0.enabled("peachpay_poynt_gateways")?(n=d.L0.metadata("peachpay_poynt_gateways","poynt_src"),e=d.L0.metadata("peachpay_poynt_gateways","business_id"),f=d.L0.metadata("peachpay_poynt_gateways","application_id"),e&&f&&n?(y={businessId:e,applicationId:f},[4,(0,o.ve)(n,null,(function(){var n=function(){var t,n,e={};if(d.L0.enabled("peachpay_poynt_card_gateway")){var r=(a={name:(0,m.M)("Card"),slug:"card",gateway:"peachpay_poynt_card",description:"",reusable:!1,assets:{title:{src:g},badge:{src:g}}},s=null,p=null,{config:a,init:function(t){var n={iFrame:{border:"0px",borderRadius:"0px",boxShadow:"none",height:"84px",width:"-webkit-fill-available"}},e=(0,o.MW)('#pp-pms-existing div.pp-pm-saved-option[data-provider="poynt"][data-method="card"][data-index=""]'),i=(0,o.MW)('#pp-pms-new div.pp-pm-saved-option[data-provider="poynt"][data-method="card"][data-index=""]');e&&i&&(e.setAttribute("id","pp-poynt-existing"),e.style.padding="0px",e.style.border="0px",e.style.width="-webkit-fill-available",(p=new w(t)).mount("pp-poynt-existing",n),i.setAttribute("id","pp-poynt-new"),i.style.padding="0px",i.style.border="0px",i.style.width="-webkit-fill-available",(s=new w(t)).mount("pp-poynt-new",n))},tokenize:function(){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){return(t=d.qA.customer.existing()?p:s)?[2,t.tokenize()]:[2,{error:"Poynt Card element not found while attempting to tokenize card."}]}))}))}});e.card=r}var a,s,p;var u={methods:{}};try{for(var h=(0,i.XA)(Object.entries(e)),v=h.next();!v.done;v=h.next()){var f=(0,i.CR)(v.value,2),y=f[0],b=f[1];u.methods[y]=b.config}}catch(n){t={error:n}}finally{try{v&&!v.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}return l.h.dispatch((0,c.DK)({poynt:u})),e}();!function(t,n,e){var f,y;try{for(var m=(0,i.XA)(Object.entries(t)),b=m.next();!b.done;b=m.next()){var g=(0,i.CR)(b.value,2),w=(g[0],g[1]);w.init&&w.init(e)}}catch(t){f={error:t}}finally{try{b&&!b.done&&(y=m.return)&&y.call(m)}finally{if(f)throw f.error}}var _=function(e){if((0,r.N6)()){var f=e.target;if(null==f?void 0:f.closest("button")){var y=t[c.hv.selectedProviderMethod()];if(y&&"poynt"===c.hv.selectedProvider())return function(t,n){return(0,i.mG)(this,void 0,void 0,(function(){var e,r,f,y,m,b;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(0,o.HD)(".pp-pm-error-text",(function(t){t.remove()})),l.h.dispatch((0,d.N5)()),[4,t.tokenize()];case 1:return e=i.sent(),r=e.nonce,f=e.error,[4,n.startTransaction(t.config.gateway)];case 2:return(y=i.sent())?(null!=f?f:!r)?("returning"===d.qA.modalUI.page()&&setTimeout((function(){(0,s.yH)("payment")}),500),[4,y.complete({paymentStatus:"creationfailed",orderStatus:"unperformed",note:null!=f?f:"An unknown error occured while retrieving the nonce."})]):[3,4]:(l.h.dispatch((0,d.tv)()),[2]);case 3:return i.sent(),(0,h.j1)(null!=f?f:"An unknown error occured while tokenizing the payment method."),l.h.dispatch((0,d.tv)()),[2];case 4:return[4,n.placeOrder(y,{peachpay_session_id:u.Z5.sessionId(),peachpay_transaction_id:y.getId(),peachpay_poynt_nonce:r})];case 5:return"failure"!==(m=i.sent()).result?[3,7]:[4,y.complete()];case 6:return i.sent(),l.h.dispatch((0,d.tv)()),[2];case 7:return l.h.dispatch((0,p.ud)({provider:c.hv.selectedProvider(),method:c.hv.selectedProviderMethod()})),[4,(0,a.ll)()];case 8:return i.sent(),(0,v.c)(),b=n.getOrderRedirect(m),window.top?[4,y.complete()]:[3,10];case 9:i.sent(),window.top.location=b,i.label=10;case 10:return[2]}}))}))}(y,n)}}};(0,o.HD)(".poynt-btn",(function(t){t.addEventListener("click",(function(t){return _(t)}))}))}(n,t,y),b()}))]):[2]):[2];case 1:return _.sent(),[2]}}))}))}},5792:(t,n,e)=>{t.exports=e.p+"img/b2c8b12eb49165de87d5-credit-card-regular.svg"}}]);