"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[565],{2367:(t,e,n)=>{n.r(e),n.d(e,{default:()=>k,paypalDescription:()=>j});var a=n(655),r=n(9350);function i(t){var e="https://www.paypal.com/sdk/js";t.sdkBaseURL&&(e=t.sdkBaseURL,delete t.sdkBaseURL),function(t){var e=t["merchant-id"],n=t["data-merchant-id"],a="",r="";Array.isArray(e)?e.length>1?(a="*",r=e.toString()):a=e.toString():"string"==typeof e&&e.length>0?a=e:"string"==typeof n&&n.length>0&&(a="*",r=n);t["merchant-id"]=a,t["data-merchant-id"]=r}(t);var n=Object.keys(t).filter((function(e){return void 0!==t[e]&&null!==t[e]&&""!==t[e]})).reduce((function(e,n){var a=t[n].toString();return"data-"===n.substring(0,5)?e.dataAttributes[n]=a:e.queryParams[n]=a,e}),{queryParams:{},dataAttributes:{}}),a=n.queryParams,r=n.dataAttributes;return{url:"".concat(e,"?").concat(o(a)),dataAttributes:r}}function o(t){var e="";return Object.keys(t).forEach((function(n){0!==e.length&&(e+="&"),e+=n+"="+t[n]})),e}function l(t,e){void 0===e&&(e={});var n=document.createElement("script");return n.src=t,Object.keys(e).forEach((function(t){n.setAttribute(t,e[t]),"data-csp-nonce"===t&&n.setAttribute("nonce",e["data-csp-nonce"])})),n}function c(t,e){if(void 0===e&&(e=u()),d(t,e),"undefined"==typeof window)return e.resolve(null);var n=i(t),a=n.url,r=n.dataAttributes,o=r["data-namespace"]||"paypal",c=s(o);return function(t,e){var n=document.querySelector('script[src="'.concat(t,'"]'));if(null===n)return null;var a=l(t,e),r=n.cloneNode();if(delete r.dataset.uidAuto,Object.keys(r.dataset).length!==Object.keys(a.dataset).length)return null;var i=!0;return Object.keys(r.dataset).forEach((function(t){r.dataset[t]!==a.dataset[t]&&(i=!1)})),i?n:null}(a,r)&&c?e.resolve(c):function(t,e){void 0===e&&(e=u());d(t,e);var n=t.url,a=t.attributes;if("string"!=typeof n||0===n.length)throw new Error("Invalid url.");if(void 0!==a&&"object"!=typeof a)throw new Error("Expected attributes to be an object.");return new e((function(t,e){if("undefined"==typeof window)return t();!function(t){var e=t.url,n=t.attributes,a=t.onSuccess,r=t.onError,i=l(e,n);i.onerror=r,i.onload=a,document.head.insertBefore(i,document.head.firstElementChild)}({url:n,attributes:a,onSuccess:function(){return t()},onError:function(){var t=new Error('The script "'.concat(n,'" failed to load.'));return window.fetch?fetch(n).then((function(n){return 200===n.status&&e(t),n.text()})).then((function(t){var n=function(t){var e=t.split("/* Original Error:")[1];return e?e.replace(/\n/g,"").replace("*/","").trim():t}(t);e(new Error(n))})).catch((function(t){e(t)})):e(t)}})}))}({url:a,attributes:r},e).then((function(){var t=s(o);if(t)return t;throw new Error("The window.".concat(o," global variable is not available."))}))}function u(){if("undefined"==typeof Promise)throw new Error("Promise is undefined. To resolve the issue, use a Promise polyfill.");return Promise}function s(t){return window[t]}function d(t,e){if("object"!=typeof t||null===t)throw new Error("Expected an options object.");if(void 0!==e&&"function"!=typeof e)throw new Error("Expected PromisePonyfill to be a function.")}var p=n(7462),y=n(7629),h=n(7059),v=n(4071),f=n(9545);function m(t){h.h.subscribe((function(){var e,n;e=y.hv.selectedProvider(),n=p.qA.modalUI.loadingMode(),"paypal"===e&&"finished"===n?((0,f.HD)(".paypal-btn-container",(function(t){t.classList.remove("hide")})),(0,f.HD)(".paypal-spinner-container",(function(t){t.classList.add("hide")}))):"paypal"===e?((0,f.HD)(".paypal-btn-container",(function(t){t.classList.add("hide")})),(0,f.HD)(".paypal-spinner-container",(function(t){t.classList.remove("hide")}))):((0,f.HD)(".paypal-btn-container",(function(t){t.classList.add("hide")})),(0,f.HD)(".paypal-spinner-container",(function(t){t.classList.add("hide")}))),function(t){var e,n,r,i,o;if("paypal"!==y.hv.selectedProvider())return;var l=Object.entries(t).sort((function(t,e){var n,r,i,o,l,c=(0,a.CR)(t,2),u=(c[0],c[1]),s=(0,a.CR)(e,2);s[0];return(null!==(i=null===(r=null===(n=s[1].state)||void 0===n?void 0:n.mountTarget)||void 0===r?void 0:r.length)&&void 0!==i?i:0)-(null!==(l=null===(o=u.state)||void 0===o?void 0:o.mountTarget.length)&&void 0!==l?l:0)}));try{for(var c=(0,a.XA)(l),u=c.next();!u.done;u=c.next()){var s=(0,a.CR)(u.value,2),d=(s[0],s[1]);d.state||(d.state={mountTarget:""});var p=g();if(d.state.mountTarget&&d.state.mountTarget!==p&&(null===(r=null==d?void 0:d.detach)||void 0===r||r.call(d),d.state.mountTarget=""),y.hv.selectedProviderMethod()===d.config.slug){if(d.state.mountTarget)continue;null===(i=null==d?void 0:d.attach)||void 0===i||i.call(d,p),d.state.mountTarget=p}else{if(!d.state.mountTarget)continue;null===(o=null==d?void 0:d.detach)||void 0===o||o.call(d),d.state.mountTarget=""}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}}(t)}))}function g(){return p.qA.customer.existing()?"#existing-customer-pay-button .paypal-btn-container":p.qA.customer.mobile()?"#mobile-customer-pay-button .paypal-btn-container":"#new-customer-pay-button .paypal-btn-container"}const b=n.p+"img/173aa60cc278bf30fb32-paypal.svg",_=n.p+"img/8c8968a2f7f7a789c35a-paypal.svg";var w=n(8401),P=n(9213),T=n(6204),L=n(9970),E=function(){function t(t,e,n){this.paypal=t,this.orderService=e,this.gatewayId=n.gatewayId,this.fundingType=n.fundingType,this.buttonStyle=n.buttonStyle,this.isMounted=!1,this.mountContainer=null,this.currentPaymentDetails=null,this.currentTransaction=null,this.button=this.createButtonComponent()}return t.prototype.isEligible=function(){var t,e;return null!==(e=null===(t=this.button)||void 0===t?void 0:t.isEligible())&&void 0!==e&&e},t.prototype.mount=function(t){var e,n;if(!this.isMounted){var a=(0,f.MW)(t);a&&(this.button||(this.button=this.createButtonComponent()),this.mountContainer?null===(e=this.mountContainer)||void 0===e||e.classList.remove("hide"):(this.mountContainer=document.createElement("div"),a.insertAdjacentElement("beforeend",this.mountContainer),null===(n=this.button)||void 0===n||n.render(this.mountContainer).catch((function(){}))),this.isMounted=!0)}},t.prototype.unmount=function(){var t;this.isMounted&&(null===(t=this.mountContainer)||void 0===t||t.remove(),this.mountContainer=null,this.button=null,this.isMounted=!1)},t.prototype.createButtonComponent=function(){var t,e,n,r=this.orderService,i=this;return null!==(n=null===(e=null===(t=this.paypal)||void 0===t?void 0:t.Buttons)||void 0===e?void 0:e.call(t,{fundingSource:this.fundingType,style:this.buttonStyle,onClick:function(){h.h.dispatch((0,p.N5)())},createOrder:function(t,e){return(0,a.mG)(this,void 0,void 0,(function(){var t,e,n,o,l,c,u,s;return(0,a.Jh)(this,(function(d){switch(d.label){case 0:return t=i,[4,r.startTransaction(i.gatewayId)];case 1:if(t.currentTransaction=d.sent(),!i.currentTransaction)return h.h.dispatch((0,p.tv)()),[2,""];d.label=2;case 2:return d.trys.push([2,8,,10]),[4,r.placeOrder(i.currentTransaction,{peachpay_session_id:w.Z5.sessionId(),peachpay_transaction_id:i.currentTransaction.getId()})];case 3:return"failure"!==(e=d.sent()).result?[3,5]:[4,i.currentTransaction.complete()];case 4:return d.sent(),h.h.dispatch((0,p.tv)()),[2,""];case 5:return n=new URL(e.redirect),o=(0,a.CR)(n.hash.split("="),2),l=o[0],c=o[1],"#payment_data"===l&&c?[3,7]:[4,i.currentTransaction.complete({note:"Failed to retrieve paypal payment details from url: "+e.redirect})];case 6:return d.sent(),h.h.dispatch((0,p.tv)()),[2,""];case 7:return u=JSON.parse(atob(decodeURIComponent(c))),i.currentPaymentDetails=u,[2,u.data.id];case 8:return s=d.sent(),[4,i.currentTransaction.complete({note:"Failed creating paypal order: "+JSON.stringify(s)})];case 9:return d.sent(),[2,""];case 10:return[2]}}))}))},onApprove:function(t,e){var n,r,o,l,c,u;return(0,a.mG)(this,void 0,void 0,(function(){var t,s,d,f,m,g,b;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return(null===(n=i.currentPaymentDetails)||void 0===n?void 0:n.order_id)?[3,2]:[4,null===(r=i.currentTransaction)||void 0===r?void 0:r.complete({note:'Failed approving paypal order: "Missing payment details"'})];case 1:return a.sent(),e.restart(),h.h.dispatch((0,p.tv)()),[2];case 2:return t=p.L0.metadata("peachpay_paypal_gateways","approve_order_url"),s=p.L0.metadata("peachpay_paypal_gateways","approve_order_security"),t&&s?[3,4]:[4,null===(o=i.currentTransaction)||void 0===o?void 0:o.complete({note:'Failed approving paypal order: "Missing required approve URL or approve URL security nonce"'})];case 3:return a.sent(),e.restart(),h.h.dispatch((0,p.tv)()),[2];case 4:return(d=new FormData).append("security",s),d.append("order_id",i.currentPaymentDetails.order_id),[4,fetch(t,{method:"POST",body:d})];case 5:f=a.sent(),a.label=6;case 6:return a.trys.push([6,10,,14]),[4,f.json()];case 7:return(m=a.sent()).success?[3,9]:[4,null===(l=i.currentTransaction)||void 0===l?void 0:l.complete({note:m.message})];case 8:return a.sent(),e.restart(),h.h.dispatch((0,p.tv)()),[2];case 9:return[3,14];case 10:return g=a.sent(),[4,null===(c=e.order)||void 0===c?void 0:c.get()];case 11:return"APPROVED"===(null==(b=a.sent())?void 0:b.status)||"COMPLETED"===(null==b?void 0:b.status)?[3,13]:(h.h.dispatch((0,w.Qe)((0,v.M)("PayPal order failed to finish."))),[4,null===(u=i.currentTransaction)||void 0===u?void 0:u.complete({note:"PayPal order failed to finish: ".concat(JSON.stringify(g))})]);case 12:return a.sent(),e.restart(),h.h.dispatch((0,p.tv)()),[2];case 13:return[3,14];case 14:return h.h.dispatch((0,L.ud)({provider:y.hv.selectedProvider(),method:y.hv.selectedProviderMethod()})),[4,(0,P.ll)()];case 15:return a.sent(),(0,T.c)(),e.redirect(i.currentPaymentDetails.success_url),[2]}}))}))},onCancel:function(t,e){var n,r;return(0,a.mG)(this,void 0,void 0,(function(){return(0,a.Jh)(this,(function(t){switch(t.label){case 0:return i.currentPaymentDetails?[3,2]:[4,null===(n=i.currentTransaction)||void 0===n?void 0:n.complete({paymentStatus:"CANCELED",orderStatus:"unknown",note:'Payment canceled by customer. Order status "unknown" because of missing payment details.'})];case 1:return t.sent(),h.h.dispatch((0,p.tv)()),[2];case 2:return[4,null===(r=null==i?void 0:i.currentTransaction)||void 0===r?void 0:r.complete({paymentStatus:"CANCELED",orderStatus:"canceled"})];case 3:return t.sent(),function(t){try{var e=new XMLHttpRequest;e.open("GET",t),e.send()}catch(t){}}(i.currentPaymentDetails.cancel_url),h.h.dispatch((0,p.tv)()),[2]}}))}))},onError:function(t){var e;return(0,a.mG)(this,void 0,void 0,(function(){return(0,a.Jh)(this,(function(n){switch(n.label){case 0:return[4,null===(e=i.currentTransaction)||void 0===e?void 0:e.complete({note:JSON.stringify(t)})];case 1:return n.sent(),i.currentTransaction=null,i.currentPaymentDetails=null,h.h.dispatch((0,p.tv)()),[2]}}))}))}}))&&void 0!==n?n:null},t}();var C=n(3493);const S=n.p+"img/cad4a91407099c0b1e1f-paypal-paylater.svg";const D=n.p+"img/2598d60ef6ba61ecf216-venmo.svg",A=n.p+"img/29b34a2d06a2137a30a2-venmo.svg";var O=n(3176);function k(t){return(0,a.mG)(this,void 0,void 0,(function(){var e,n,i,o,l,u,s=this;return(0,a.Jh)(this,(function(d){return p.L0.enabled("peachpay_paypal_gateways")?(e=p.L0.metadata("peachpay_paypal_gateways","client_id"),n=p.L0.metadata("peachpay_paypal_gateways","merchant_id"),i=p.L0.metadata("peachpay_paypal_gateways","partner_attribution_id"),e&&n&&i?(o=function(){var t,e,n={};if(p.L0.enabled("peachpay_paypal_wallet_gateway")){var r=function(){var t,e=null,n={initialized:!1,name:null!==(t=p.L0.metadata("peachpay_paypal_wallet_gateway","title"))&&void 0!==t?t:"PayPal",gateway:"peachpay_paypal_wallet",description:j("PayPal",_,"After selecting the PayPal button you will be prompted to complete your payment."),slug:"paypal_wallet",assets:{badge:{src:b},title:{src:_}}};return{config:n,activate:function(t,a){var r;e=new E(t,a,{gatewayId:"peachpay_paypal_wallet",fundingType:"paypal",buttonStyle:null!==(r=p.L0.metadata("peachpay_paypal_wallet_gateway","button_style"))&&void 0!==r?r:void 0}),n.initialized=e.isEligible(),h.h.dispatch((0,C.s)())},reset:function(){null==e||e.unmount(),e=null,n.initialized=!1,h.h.dispatch((0,C.s)())},attach:function(t){null==e||e.mount(t)},detach:function(){null==e||e.unmount()}}}();n.paypal_wallet=r}if(p.L0.enabled("peachpay_paypal_venmo_gateway")){var i=function(){var t,e=null,n={initialized:!1,name:null!==(t=p.L0.metadata("peachpay_paypal_venmo_gateway","title"))&&void 0!==t?t:"Venmo",gateway:"peachpay_paypal_venmo",slug:"venmo",description:j("Venmo",A,"After selecting the Venmo button you will be prompted to complete your payment."),assets:{badge:{src:D},title:{src:A}}};return{config:n,activate:function(t,a){var r;e=new E(t,a,{gatewayId:"peachpay_paypal_venmo",fundingType:"venmo",buttonStyle:null!==(r=p.L0.metadata("peachpay_paypal_venmo_gateway","button_style"))&&void 0!==r?r:void 0}),n.initialized=e.isEligible(),h.h.dispatch((0,C.s)())},reset:function(){null==e||e.unmount(),e=null,n.initialized=!1,h.h.dispatch((0,C.s)())},attach:function(t){null==e||e.mount(t)},detach:function(){null==e||e.unmount()}}}();n.venmo=i}if(p.L0.enabled("peachpay_paypal_paylater_gateway")){var o=function(){var t,e=null,n={initialized:!1,name:null!==(t=p.L0.metadata("peachpay_paypal_paylater_gateway","title"))&&void 0!==t?t:"PayPal Pay Later",gateway:"peachpay_paypal_paylater",description:j("PayPal Pay Later",S,"After selecting the PayPal Pay Later button you will be prompted to complete your payment."),slug:"paypal_paylater",assets:{badge:{src:b},title:{src:S}}};return{config:n,activate:function(t,a){var r;e=new E(t,a,{gatewayId:"peachpay_paypal_paylater",fundingType:"paylater",buttonStyle:null!==(r=p.L0.metadata("peachpay_paypal_paylater_gateway","button_style"))&&void 0!==r?r:void 0}),n.initialized=e.isEligible(),h.h.dispatch((0,C.s)())},reset:function(){null==e||e.unmount(),e=null,n.initialized=!1,h.h.dispatch((0,C.s)())},attach:function(t){null==e||e.mount(t)},detach:function(){null==e||e.unmount()}}}();n.paypal_paylater=o}if(p.L0.enabled("peachpay_paypal_credit_gateway")){var l=function(){var t,e=null,n={initialized:!1,name:null!==(t=p.L0.metadata("peachpay_paypal_credit_gateway","title"))&&void 0!==t?t:"PayPal Credit",slug:"paypal_credit",gateway:"peachpay_paypal_credit",description:j("PayPal Credit",_,"After selecting the PayPal Credit button you will be prompted to complete your payment."),assets:{badge:{src:b},title:{src:_}}};return{config:n,activate:function(t,a){var r;e=new E(t,a,{gatewayId:"peachpay_paypal_credit",fundingType:"credit",buttonStyle:null!==(r=p.L0.metadata("peachpay_paypal_credit_gateway","button_style"))&&void 0!==r?r:void 0}),n.initialized=e.isEligible(),h.h.dispatch((0,C.s)())},reset:function(){null==e||e.unmount(),e=null,n.initialized=!1,h.h.dispatch((0,C.s)())},attach:function(t){null==e||e.mount(t)},detach:function(){null==e||e.unmount()}}}();n.paypal_credit=l}var c={methods:{}};try{for(var u=(0,a.XA)(Object.entries(n)),s=u.next();!s.done;s=u.next()){var d=(0,a.CR)(s.value,2),v=d[0],f=d[1];c.methods[v]=f.config}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}return h.h.dispatch((0,y.DK)({paypal:c})),n}(),m(o),l=new Set(["USD","AUD","BRL","CAD","CZK","DKK","EUR","HKD","HUF","ILS","JPY","MYR","MXN","TWD","NZD","NOK","PHP","PLN","GBP","RUB","SGD","SEK","CHF","THB"]),u="",h.h.subscribe((function(){return(0,a.mG)(s,void 0,void 0,(function(){var s,d,p,y,h,v,f,m,g;return(0,a.Jh)(this,(function(b){switch(b.label){case 0:if((s=r.l9.currency.code())===u)return[2];u=s;try{for(d=(0,a.XA)(Object.entries(o)),p=d.next();!p.done;p=d.next())y=(0,a.CR)(p.value,2),y[0],(h=y[1]).reset(),h.state=void 0}catch(t){m={error:t}}finally{try{p&&!p.done&&(g=d.return)&&g.call(d)}finally{if(m)throw m.error}}if(!l.has(s))return[2];b.label=1;case 1:return b.trys.push([1,4,,5]),[4,c({"client-id":e,"merchant-id":n,"data-partner-attribution-id":i,"enable-funding":"venmo",currency:r.l9.currency.code(),"data-page-type":"checkout"})];case 2:return(v=b.sent())?[4,R(v,o,t)]:[2];case 3:return b.sent(),[3,5];case 4:return f=b.sent(),(0,O.W4)(new Error("PayPal SDK failed to load"),{error:f}),[3,5];case 5:return[2]}}))}))})),[2]):[2]):[2]}))}))}function R(t,e,n){return(0,a.mG)(this,void 0,void 0,(function(){var r,i,o,l,c,u,s;return(0,a.Jh)(this,(function(d){switch(d.label){case 0:r=[];try{for(i=(0,a.XA)(Object.entries(e)),o=i.next();!o.done;o=i.next())l=(0,a.CR)(o.value,2),l[0],(c=l[1]).activate&&r.push(c.activate(t,n))}catch(t){u={error:t}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(u)throw u.error}}return[4,Promise.all(r)];case 1:return d.sent(),[2]}}))}))}function j(t,e,n){return'\n    <img style="display: block; text-align: left; height: 1.7rem; " src="'.concat(e,'">\n    <p style="text-align: left; margin: 0.5rem 0;">').concat(t," ").concat((0,v.M)("selected for checkout."),'</p>\n    <hr>\n    <p style="text-align: left; margin: 0.5rem 0 0;" class="muted">').concat(n,"</p>")}}}]);