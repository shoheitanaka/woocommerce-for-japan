"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[475],{2475:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var a=n(655),i=n(7462),r=n(7059),o=n(3658),c=n(4071),s=n(8883),u=n(5792);var d=n(7629),l=n(9545),p=n(6673),h=n(1212);function f(){r.h.subscribe((function(){!function(t,e,n,a){"authnet"===t&&("payment"===e||"returning"===e)&&a>0?(0,l.HD)(".authnet-btn",(function(t){t.classList.remove("hide")})):(0,l.HD)(".authnet-btn",(function(t){t.classList.add("hide")}));"authnet"===t&&("payment"===e||"returning"===e)&&"loading"!==n&&a>0?(0,l.HD)(".authnet-btn",(function(t){t.classList.remove("hide")})):(0,l.HD)(".authnet-btn",(function(t){t.classList.add("hide")}))}(d.hv.selectedProvider(),i.qA.modalUI.page(),i.qA.modalUI.loadingMode(),p.AQ.total()),function(t,e){if("authnet"!==t)return;"finished"===e?(0,l.HD)(".authnet-btn",(function(t){t.disabled=!1})):(0,l.HD)(".authnet-btn",(function(t){t.disabled=!0}));"loading"===e?(0,l.HD)(".pp-btn-spinner-container",(function(t){t.classList.remove("hide")})):(0,l.HD)(".pp-btn-spinner-container ",(function(t){t.classList.add("hide")}));"processing"===e?((0,l.HD)(".authnet-btn > .button-text",(function(t){t.innerHTML=(0,c.M)("Processing")})),(0,l.HD)(".modal-lock-icon",(function(t){t.classList.add("hide")})),(0,l.HD)(".authnet-btn-spinner",(function(t){t.classList.remove("hide")}))):((0,l.HD)(".authnet-btn > .button-text",(function(t){t.innerHTML="".concat((0,c.M)("Pay")," ").concat((0,h.o)(p.AQ.total()))})),(0,l.HD)(".authnet-btn-spinner",(function(t){t.classList.add("hide")})))}(d.hv.selectedProvider(),i.qA.modalUI.loadingMode())}))}var v=n(8401),b=n(6204),m=n(9213),y=n(9970),g=n(9402);var w=function(){function t(t){this.loginId=t.loginId,this.clientKey=t.clientKey,this.scriptSrc=t.acceptSrc,this.$script=null,this.$button=null}return t.prototype.tokenize=function(e){return(0,a.mG)(this,void 0,void 0,(function(){var n=this;return(0,a.Jh)(this,(function(i){switch(i.label){case 0:if(t.isTokenizing)throw new Error("Tokenization is already in progress. Only 1 tokenization attempt may occur at a time.");return t.isTokenizing=!0,[4,this.mount(e)];case 1:return i.sent(),[4,new Promise((function(t){setTimeout((function(){t()}),1e3)}))];case 2:return i.sent(),[2,new Promise((function(e,i){var r,o;n.$button||i(new Error("Failed to locate Authorize.net tokenize button")),window.peachpayAuthnetResponseHandler=function(n){"Ok"===n.messages.resultCode&&n.opaqueData?e({token:{descriptor:n.opaqueData.dataDescriptor,value:n.opaqueData.dataValue}}):"Error"===n.messages.resultCode?e({error:n.messages.message.map((function(t){return{code:t.code,message:t.text}}))}):i(new Error("Unhandled Authorize.net tokenization response.")),window.peachpayAuthnetResponseHandler=void 0,t.isTokenizing=!1},null===(r=n.$button)||void 0===r||r.click();var c=(0,l.MW)("#AcceptUIContainer"),s=null===(o=(0,l.MW)("#AcceptUIContainer"))||void 0===o?void 0:o.parentNode,u=new MutationObserver((function(n){var i,r;try{for(var o=(0,a.XA)(n),s=o.next();!s.done;s=o.next()){var d=s.value;"childList"===d.type&&d.removedNodes[0]===c&&(u.disconnect(),e({cancel:!0}),window.peachpayAuthnetResponseHandler=void 0,t.isTokenizing=!1)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}}));s&&u.observe(s,{attributes:!1,childList:!0,subtree:!1})}))]}}))}))},t.prototype.mount=function(t){return(0,a.mG)(this,void 0,void 0,(function(){var e=this;return(0,a.Jh)(this,(function(n){return this.unmount(),[2,new Promise((function(n,a){var i={showCreditCard:"card"===t||"all"===t,showBankAccount:"bank"===t||"all"===t},r=document.createElement("button");r.classList.add("AcceptUI"),r.setAttribute("style","display: none;"),r.setAttribute("type","button"),r.setAttribute("data-billingAddressOptions",'{"show":false,"required":false}'),r.setAttribute("data-apiLoginID",e.loginId),r.setAttribute("data-clientKey",e.clientKey),r.setAttribute("data-acceptUIFormBtnTxt","Submit"),r.setAttribute("data-acceptUIFormHeaderTxt","Card Information"),r.setAttribute("data-paymentOptions",JSON.stringify(i)),r.setAttribute("data-responseHandler","peachpayAuthnetResponseHandler"),r.textContent="Pay",e.$button=r;var o=document.createElement("script");o.type="text/javascript",o.src=e.scriptSrc,o.classList.add("pp-authnet-accept-script"),o.onload=function(){n()},o.onerror=function(){a(new Error("Failed to load tokenization script."))},e.$script=o,document.body.appendChild(r),document.body.appendChild(o)}))]}))}))},t.prototype.unmount=function(){var t,e;null===(t=this.$script)||void 0===t||t.remove(),null===(e=this.$button)||void 0===e||e.remove(),(0,l.HD)("#AcceptUIBackground,#AcceptUIContainer",(function(t){t.remove()}))},t.isTokenizing=!1,t}();function _(t){var e=this,n=i.L0.metadata("peachpay_authnet_gateways","accept_src"),p=i.L0.metadata("peachpay_authnet_gateways","public_client_key"),h=i.L0.metadata("peachpay_authnet_gateways","login_id");if(h&&p&&n){var _=new w({loginId:h,clientKey:p,acceptSrc:n}),k=function(){var t,e,n={};if(i.L0.enabled("peachpay_authnet_card_gateway")){var o=function(){var t;return{config:{name:null!==(t=i.L0.metadata("peachpay_authnet_card_gateway","title"))&&void 0!==t?t:(0,c.M)("Card"),slug:"card",gateway:"peachpay_authnet_card",description:"".concat((0,c.M)("After clicking <b>Pay</b>, a window will appear where you can enter your card information.")),reusable:!1,assets:{title:{src:u},badge:{src:s}}}}}();n.card=o}if(i.L0.enabled("peachpay_authnet_echeck_gateway")){var l=function(){var t;return{config:{name:null!==(t=i.L0.metadata("peachpay_authnet_echeck_gateway","title"))&&void 0!==t?t:(0,c.M)("US bank account"),slug:"us_bank_account",gateway:"peachpay_authnet_echeck",description:"".concat((0,c.M)("After clicking <b>Pay</b>, a window will appear where you can enter your card information.")),reusable:!1,assets:{title:{src:g},badge:{src:g}}}}}();n.bank=l}var p={methods:{}};try{for(var h=(0,a.XA)(Object.entries(n)),f=h.next();!f.done;f=h.next()){var v=(0,a.CR)(f.value,2),b=v[0],m=v[1];p.methods[b]=m.config}}catch(e){t={error:e}}finally{try{f&&!f.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}return r.h.dispatch((0,d.DK)({authnet:p})),n}();f(),(0,l.HD)(".authnet-btn",(function(n){n.addEventListener("click",(function(){return(0,a.mG)(e,void 0,void 0,(function(){var e,n,c,s,u,l,p,h,f,g;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return r.h.dispatch((0,i.N5)()),(e=k[d.hv.selectedProviderMethod()])&&"authnet"===d.hv.selectedProvider()?(n=d.hv.selectedProviderMethod(),[4,_.tokenize(n)]):[2];case 1:return c=a.sent(),s=c.token,u=c.error,l=c.cancel,[4,t.startTransaction(e.config.gateway,e.config.slug)];case 2:return(p=a.sent())?l?(r.h.dispatch((0,i.tv)()),[2]):(null!=u?u:!s)?((0,o.j1)(null!==(g=null==u?void 0:u.map((function(t){return"".concat(t.code,": ").concat(t.message)})).join("\n"))&&void 0!==g?g:"An unknown error occured while tokenizing the payment method."),r.h.dispatch((0,i.tv)()),[2]):[4,t.placeOrder(p,{peachpay_session_id:v.Z5.sessionId(),peachpay_transaction_id:p.getId(),peachpay_authnet_data_descriptor:s.descriptor,peachpay_authnet_data_value:s.value})]:(r.h.dispatch((0,i.tv)()),[2]);case 3:return"failure"!==(h=a.sent()).result?[3,5]:((0,o.j1)(h.message),[4,null==p?void 0:p.complete()]);case 4:return a.sent(),r.h.dispatch((0,i.tv)()),[2];case 5:return r.h.dispatch((0,y.ud)({provider:"authnet",method:"card"})),[4,(0,m.ll)()];case 6:return a.sent(),(0,b.c)(),f=t.getOrderRedirect(h),window.top?[4,null==p?void 0:p.complete()]:[3,8];case 7:a.sent(),window.top.location=f,a.label=8;case 8:return[2]}}))}))}))}))}}},8883:(t,e,n)=>{t.exports=n.p+"img/d2a66f3e82ab3efab425-card.svg"},9402:(t,e,n)=>{t.exports=n.p+"img/e7542fee9125d1af4d23-bank.svg"},5792:(t,e,n)=>{t.exports=n.p+"img/b2c8b12eb49165de87d5-credit-card-regular.svg"}}]);